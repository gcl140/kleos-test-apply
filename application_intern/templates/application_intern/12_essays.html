{% extends 'application_intern/besi.html' %}
{% load crispy_forms_tags %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Essay Writing Section{% endblock %}

{% block info_title %}Essay Writing Section{% endblock %}

{% block info_description %}
<div class="text-gray-300 mb-6">

This section provides you with an opportunity to express your thoughts and experiences through written essays. Your
responses will help us understand your perspectives, aspirations, and how you articulate your ideas.
</div>
<div class="text-gray-300 mb-6">
    <p>
    <strong>Note:</strong> Fields marked with an asterisk (<span class="required">*</span>) are mandatory.
</p>
</div>

{% endblock %}
{% block info_hints %}
<div class="space-y-4">
    <div class="bg-primary-dark/30 p-4 rounded-lg">
        <h4 class="font-bold text-white mb-2">
            <i class="fas fa-lightbulb mr-2 text-secondary"></i> Reflection Tips
        </h4>
        <p class="text-gray-300 text-base">
            Reflect on your personal experiences and how they have shaped your views.
        </p>
    </div>

    <div class="bg-primary-dark/30 p-4 rounded-lg">
        <h4 class="font-bold text-white mb-2">
            <i class="fas fa-list-ul mr-2 text-secondary"></i> Specificity
        </h4>
        <p class="text-gray-300 text-base">
            Be specific and provide examples to illustrate your points effectively.
        </p>
    </div>

    <div class="bg-primary-dark/30 p-4 rounded-lg">
        <h4 class="font-bold text-white mb-2">
            <i class="fas fa-ruler mr-2 text-secondary"></i> Word Limits
        </h4>
        <p class="text-gray-300 text-base">
            Adhere to the word limits specified for each essay prompt.
        </p>
    </div>

    <div class="bg-primary-dark/30 p-4 rounded-lg">
        <h4 class="font-bold text-white mb-2">
            <i class="fas fa-spell-check mr-2 text-secondary"></i> Proofreading
        </h4>
        <p class="text-gray-300 text-base">
            Proofread your essays for clarity, grammar, and coherence before submission.
        </p>
    </div>
    <div class="bg-primary-dark/30 p-4 rounded-lg">
        <h4 class="font-bold text-white mb-2">
            <i class="fas fa-brain mr-2 text-secondary"></i> Thoughtfulness
        </h4>
        <p class="text-gray-300 text-base">
            Take your time to think critically; thoughtful responses are encouraged.
        </p>
    </div>
    <div class="bg-primary-dark/30 p-4 rounded-lg">
        <h4 class="font-bold text-white mb-2">
            <i class="fas fa-lightbulb text-yellow-300 mr-3 text-xl animate-pulse"></i>
            Just a Thought!
        </h4>
        <p class="text-gray-200 text-base">
            You've got this — keep going strong!
        </p>
    </div>
    
</div>
{% endblock %}
{% block form_content %}
<style>
    .required{
        color: rgb(255, 144, 144) !important;
    }
</style>
<form method="POST" enctype="multipart/form-data" class="">
    {% csrf_token %}
    <h2 class="text-2xl font-bold mb-6 text-secondary">
        Essays
    </h2>
    
    <div class="space-y-6">
        <!-- Essay Questions Section -->
        <div class="">
            <!-- Significant Activity -->
            <div>
                <label class="form-label mb-4">
                    <i class="fas fa-pen-fancy mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">            From the activities you listed in section 9, choose the one that holds the most significance for you and explain why. [150 words max]<span class="required">*</span>
</span>
                </label>
                {{ form.extrac|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:150" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/150 words</p>
                {% if form.extrac.errors %}
                <div class="text-danger mt-2 text-red-400">{{ form.extrac.errors }}</div>
                {% endif %}
            </div>
            
            <!-- Challenge Reflection -->
            <div>
                <label class="form-label mb-4">
                    <i class="fas fa-mountain mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">            Reflect on a moment in your life when you faced a significant challenge. How did you navigate through it, and what impact, if any, has it had on shaping the person you are today? [200 words max]
                    <span class="required">*</span></span>
                </label>
                {{ form.chlg|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:200" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/200 words</p>
                {% if form.chlg.errors %}
                <div class="text-danger mt-2 text-red-400">{{ form.chlg.errors }}</div>
                {% endif %}
            </div>
            
            <!-- Teaching Class -->
            <div>
                <label class="form-label mb-4">
                    <i class="fas fa-users mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">Being a TanSAF intern entails great responsibility—it requires serving others just as much as, if not more than, serving yourself. It calls for leadership. Can you share a time when you demonstrated leadership and made a meaningful contribution to others? What did this experience mean to you? [250 words max]<span class="required">*</span></span>
                </label>
                {{ form.cohort|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:250" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/250 words</p>
                {% if form.cohort.errors %}
                <div class="text-danger mt-2 text-red-400">{{ form.cohort.errors }}</div>
                {% endif %}
            </div>
            
            <!-- Teaching Class -->
            <div>
                <label class="form-label mb-4">
                    <i class="fas fa-chalkboard-teacher mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">            If you could teach one class to your class, what would it be about?
                        [150 words max]<span class="required">*</span></span>
                </label>
                {{ form.teach|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:150" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/150 words</p>
                {% if form.teach.errors %}
                <div class="text-danger mt-2 text-red-400">{{ form.teach.errors }}</div>
                {% endif %}
            </div>
            
            <!-- Standing Out -->
            <div>
                <label class="form-label mb-4">
                    <i class="fas fa-star mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">
                        The TanSAF internship selection process is highly competitive, and so is gaining admission to top universities in North America. What makes you stand out from other high-achieving Tanzanian students? Why should we choose you? You may consider factors such as your background, identity, interests, talents, or any other significant aspect of your life that you believe is essential to your application. [250 words max]
                        <span class="required">*</span></span>
                </label>
                {{ form.why_you|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:250" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/250 words</p>
                {% if form.why_you.errors %}
                <div class="text-danger mt-2 text-red-400">{{ form.why_you.errors }}</div>
                {% endif %}
            </div>
            
            <!-- Why TanSAF -->
            <div>
                <label class="form-label mb-4">
                    <i class="fas fa-question-circle mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">
                        TanSAF is renowned for supporting high-achieving, low-income Tanzanian students in gaining admission to prestigious universities. 
                         Other than
                        that, in one sentence, why TanSAF? [50 words max]<span class="required">*</span></span>
                </label>
                {{ form.why_tansaf|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:50" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/50 words</p>
                {% if form.why_tansaf.errors %}
                <div class="text-danger mt-2 text-red-400">{{ form.why_tansaf.errors }}</div>
                {% endif %}
            </div>
        </div>
        
        <!-- Disciplinary Section -->
        <div class="bg-white/80 dark:bg-gray-800/10 p-4 rounded-xl shadow-sm">
            <h3 class="text-lg font-semibold mb-4 text-secondary flex items-center gap-2">
                <i class="fas fa-exclamation-triangle"></i>
                Disciplinary Violation
            </h3>
            
            <label class="checkbox-label">
                {{ form.has_disciplinary_violation|add_class:"form-checkbox h-5 w-5 text-primary-500 rounded focus:ring-primary-500" }}
                <span>        Have you ever been found responsible for a disciplinary violation at any educational institution you have attended from Form 3/Grade 9 onward? This may include, but is not limited to, academic misconduct or behavioral misconduct that resulted in any form of disciplinary action, such as probation, suspension, removal, dismissal, or expulsion from the institution. <em>(Checking this box means YES. Leaving it unchecked means NO.)</em>
                </span>
            </label>
            
            <div id="disciplinary-fields" class="mt-4" style="display: {% if form.has_disciplinary_violation.value %}block{% else %}none{% endif %};">
                <label class="form-label mb-4">
                    <i class="fas fa-info-circle mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">If yes, please provide the approximate date(s) of each incident, explain the circumstances surrounding the situation, and reflect on what you learned from the experience. (250 words max)</span>
                </label>
                {{ form.disciplinary_details|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:250" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/250 words</p>
            </div>
        </div>
        
        <!-- Additional Circumstances Section -->
        <div class="bg-white/80 dark:bg-gray-800/10 p-4 rounded-xl shadow-sm">
            <h3 class="text-lg font-semibold mb-4 text-secondary flex items-center gap-2">
                <i class="fas fa-plus-circle"></i>
                Additional Circumstances
            </h3>
            
            <label class="checkbox-label">
                {{ form.additional_circumstances|add_class:"form-checkbox h-5 w-5 text-primary-500 rounded focus:ring-primary-500" }}
                <span>Do you wish to provide any details of circumstances or qualifications not reflected in the application?<em>(Checking this box means YES. Leaving it unchecked means NO.)</em></span>
            </label>
            
            <div id="circumstances-fields" class="mt-4" style="display: {% if form.additional_circumstances.value %}block{% else %}none{% endif %};">
                <label class="form-label mb-4">
                    <i class="fas fa-info-circle mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">
                        If yes, please use the space below to provide any additional information you wish to share. (250 words max)</span>
                </label>
                {{ form.additional_circumstances_details|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:250" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/250 words</p>
            </div>
        </div>
        
        <!-- COVID Impact Section -->
        <div class="bg-white/80 dark:bg-gray-800/10 p-4 rounded-xl shadow-sm">
            <h3 class="text-lg font-semibold mb-4 text-secondary flex items-center gap-2">
                <i class="fas fa-virus"></i>
                COVID-19 Impact
            </h3>
            
            <label class="checkbox-label">
                {{ form.covid_impact|add_class:"form-checkbox h-5 w-5 text-primary-500 rounded focus:ring-primary-500" }}
                <span>
                    Would you like to share the impact(s) of COVID-19 or other community disruptions on your life?<em>(Checking this box means YES. Leaving it unchecked means NO.)</em></span>
            </label>
            
            <div id="covid-fields" class="mt-4" style="display: {% if form.covid_impact.value %}block{% else %}none{% endif %};">
                <label class="form-label mb-4">
                    <i class="fas fa-info-circle mr-2 text-blue-600 dark:text-blue-400"></i>
                    <span class="text-gray-800 dark:text-gray-200">Please describe how these events have impacted you personally, academically, or in any other significant way. (250 words max)</span>
                </label>
                {{ form.covid_impact_details|add_class:"form-input w-full rounded-lg mt-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/50 word-count-input"|attr:"data-max-words:250" }}
                <p class="word-count text-muted mt-1 text-sm mb-4">0/250 words</p>
            </div>
        </div>
        
        <!-- Navigation Buttons -->
        <hr class="my-4 border-gray-600/20" />

        <div class="flex flex-col sm:flex-row justify-between items-stretch gap-4 pt-8">
            <a href="{{ previous_url }}"
                class="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary-light text-white rounded-xl shadow hover:bg-primary-dark hover:shadow-blue-500/30 transition-all duration-300">
                <i class="fas fa-arrow-left"></i>
                <span>Back</span>
            </a>
        
            <button type="submit" id="next-button"
                class="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-secondary-light text-white rounded-xl shadow hover:bg-secondary-dark hover:shadow-blue-500/30 transition-all duration-300">
                <span>Save & Continue</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const hasDisciplinaryViolation = document.getElementById('id_has_disciplinary_violation');
        const disciplinaryFields = document.getElementById('disciplinary-fields');
        const additionalCircumstances = document.getElementById('id_additional_circumstances');
        const circumstancesFields = document.getElementById('circumstances-fields');
        const covidImpact = document.getElementById('id_covid_impact');
        const covidFields = document.getElementById('covid-fields');
        const nextButton = document.getElementById('next-button');
    
        function countWords(str) {
            str = str.trim();
            return str === '' ? 0 : str.split(/\s+/).length;
        }
    
        function updateWordCount(input) {
            const maxWords = parseInt(input.dataset.maxWords);
            const wordCount = countWords(input.value);
            const countDisplay = input.nextElementSibling;
            countDisplay.textContent = `${wordCount}/${maxWords} words`;
    
            let hasOverflow = false;
            const allTextareas = document.querySelectorAll('.word-count-input');
            allTextareas.forEach(textarea => {
                if (textarea.offsetParent !== null) {
                    const max = parseInt(textarea.dataset.maxWords);
                    const count = countWords(textarea.value);
                    if (count > max) {
                        hasOverflow = true;
                        textarea.nextElementSibling.classList.add('exceeded');
                        textarea.style.borderColor = 'red !important';
                    } else {
                        textarea.nextElementSibling.classList.remove('exceeded');
                        textarea.style.borderColor = '';
                    }
                }
            });
    
            if (nextButton) {
                nextButton.disabled = hasOverflow;
                nextButton.title = hasOverflow ? 'Please fix the word count limits before proceeding' : '';
                nextButton.classList.toggle('opacity-50', hasOverflow);
                nextButton.classList.toggle('cursor-not-allowed', hasOverflow);
            }
        }
    
        function toggleFieldsAndUpdateCounts(checkbox, target) {
            if (!checkbox || !target) return;
            checkbox.addEventListener('change', () => {
                target.style.display = checkbox.checked ? 'block' : 'none';
                const visibleTextareas = target.querySelectorAll('.word-count-input');
                visibleTextareas.forEach(textarea => updateWordCount(textarea));
            });
            if (checkbox.checked) {
                target.style.display = 'block';
                const visibleTextareas = target.querySelectorAll('.word-count-input');
                visibleTextareas.forEach(textarea => updateWordCount(textarea));
            }
        }
    
        // Initialize word counters
        document.querySelectorAll('.word-count-input').forEach(textarea => {
            textarea.addEventListener('input', () => updateWordCount(textarea));
            textarea.addEventListener('paste', () => setTimeout(() => updateWordCount(textarea), 0));
            updateWordCount(textarea);
        });
    
        // Hook up toggle logic
        toggleFieldsAndUpdateCounts(hasDisciplinaryViolation, disciplinaryFields);
        toggleFieldsAndUpdateCounts(additionalCircumstances, circumstancesFields);
        toggleFieldsAndUpdateCounts(covidImpact, covidFields);
    });
    </script>
    
<style>
    .required {
        color: rgb(255, 144, 144) !important;
    }
    
    .form-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .word-count.exceeded {
        color: red !important;
    }
    
    .checkbox-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: white;
        margin-bottom: 0.5rem;
    }
    
    button:disabled {
        opacity: 0.5 !important;
        cursor: not-allowed !important;
    }
    .textarea-wrapper.exceeded {
    border: 1px solid red;
}

</style>

{% endblock %}